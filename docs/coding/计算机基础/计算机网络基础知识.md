---
title: 计算机网络基础知识
date: 2020-3-12 8:33
tags: [考研, 计算机基础]
---

<CreateTime/>
<TagLinks />

摘抄自[💗 前端需要了解的计算机网络知识， 这一篇就够了！(图文并茂，万字长文，点赞收藏哦！)](https://juejin.im/post/5e51febde51d4526c932b390)

## 计算机网络概念

计算机网络是一个将分散的、具有独立功能的`计算机系统`， 通过`通信设备`与`线路`连接起来，由功能完善的`软件`实现资源共享和信息传递的系统。

这里需要注意的是，按分布范围，计算机网络里有`局域网LAN`和`广域网WAN`，其中`局域网`的代表是`以太网`，以及这两种网络最重要的区分点，`局域网`基于`广播技术`，`广域网`基于`分组交换`技术。（这些概念听一下就行，后面会详细介绍，因为理解广播和分组交换技术，大体上就理解了局域网和广域网）

## 衡量计算机网络性能的指标

这些内容主要是为了学习后面具体的协议，以及分析这些协议的报文时，需要掌握的基本概念。

### 速率

速率就是数据传输（数据是指 0 和 1）的速率，比如你用迅雷下载，1 兆每秒，来衡量目前数据传输的快慢。它是计算机网络中最重要的一个性能指标。

### 带宽

在计算机网络中，网络带宽是指在单位时间（一般指的是 1 秒钟）内能传输的数据量，比如说你家的电信网络是 100 兆比特，意思是，一秒内最大的传输速率是 100 兆比特。

### 吞吐量

吞吐量表示在单位时间内通过某个网络（或信道、接口）的数据量。

以上三点，我们举个案例：

- 一条路每秒最多能过 100 辆车（带宽就相当于 100 辆/秒）。

- 而并不是每秒都会有 100 辆车过，假如第一秒有 0 辆，第二秒有 10 辆...，（但是最多不能超过 100 辆）。

- 所以有第 1 秒 0 辆/秒，第 2 秒 10 辆/秒，第 3 秒 30 辆/秒，这不能说带宽多少吧，于是就用吞吐量表示具体时间通过的量有多少（也有可能等于带宽的量）。

- 由此可知带宽是说的是最大值速率，吞吐量说的是某时刻速率。但吞吐量不能超过最大速率。

### 时延

时延是指数据（报文/分组/比特流）从网络（或链路）的一端传送到另一端所需的时间。单位是 s。 时延分一下几种：

- 发送时延
  就是说我跟你说话，从我开始说，到说话结束这段时间，就是`发送时延`。

- 传播时延
  信道上第一个比特开始，到最后一个比特到达主机接口需要的时间就是`传播时延`。

- 排队时延

  - 分组在经过网络传输时，要经过很多的`路由器`。
  - 但分组在进入路由器后要先在输入队列中`排队等待`处理。
  - 在路由器确定了转发接口后，还要在输出队列中排队等待转发，这就产生了`排队时延`。
  - 排队时延的长短往往取决于网络当时的通信量，当网络的通信量很大时会发生排队溢出，为`分组丢失`。

- 处理时延
  `路由器`或`主机`在收到数据包时，要花费一定时间进行处理，例如`分析数据包的首部`，进行`首部差错检验`，`查找路由表`为数据包选定准发接口，这就产生了`处理时延`。

- 往返时间 RTT（Round-Trip Time）
  在计算机网络中，往返时间也是一个重要的性能指标，它表示从发送方发送数据开始，到发送方收到来自接收方的确认（接受方收到数据后便立即发送确认）`总共经历的时间`

- 时延带宽积
  是指传播时延乘以带宽

## 正文开始！OSI 参考模型

`OSI`参考模型是网络互连的`七层`框架，这里不详细介绍了，每一层的具体内容会在后面介绍，这里只需要有一个初步的印象。

如下图所示，1，2，3 层主要是是`物理链路`组成的，比如`光纤`，`路由器`，`集线器`，主要负责的是`数据通信`。5，6，7 层是`软件控制`的，比如`http协议`，是一种软件层面控制的协议，主要负责处理传输来的`数据`。

<!-- ![OSImodel](../illustrations/bas_know_of_com_met/OSImodel.png) -->
<div class="img-layout">
  <img src="../illustrations/bas_know_of_com_met/OSImodel.png"/>
</div>

## 物理层

### 物理层有啥用？

对于物理层，有人会说，这不就是网线吗，比如家里连接路由器的网线，电线杆上的光纤？其实不然，物理层更多的是规定一种`标准`，他并不管物理介质具体是什么，比如电线杆上是光纤还是双绞线，只要你能按物理层规定的标准传输数据就行。

那物理层到底有哪些主要任务呢？

- 比如说，规定了`电气特性`，信号的电平用`+10V - +15V`表示二进制的`0`，用`-10V - -15V`表示二进制的`1`，只要条网线能表示这个特性，就不管你用什么材料了。

- 当然还有其它特性，我们不需要了解，知道`物理层是规定传输媒体接口的标准`即可。

### 光纤宽带上网是以什么样的形式传输数据呢？

- 首先计算机`网卡`传输出来的数据是`电信号`，`光纤`传输的是`光脉冲`信号，有光脉冲表示`1`，无光脉冲表示`0`。

- 而可见光的频率大约是`10的8次方MHz`，因此光纤通信系统的带宽远远大于其它各种传输媒介的带宽。

- 所以我们计算机传输数据需要先把`电信号`转为`光信号`，然后`光信号`快到服务器的时候，再把`光信号`转为`电信号`。

### 物理层设备中继器

为什么需要中继器呢？

因为在线路上传输的信号功率会`逐渐衰减`，衰减到一定程度时将造成`信号失真`，因此会导致接收错误。

中继器可以对信号进行`再生`和`还原`，增加信号的传输距离。

需要注意的是，中继器两端连接`不同的网段`，而不是子网。什么叫不同的网段呢，需要在网络层学习`IP分类`之后才能够理解这个概念，这里简单的理解为，不同的网段就是`不同路由器连接的网络`。

接下来我们进入下一层，数据链路层！

## 数据链路层

### 数据链路层是做什么的呢？

我们用一个小故事来举例

<div class="img-layout">
  <img src="../illustrations/bas_know_of_com_met/func_of_DLL.png"/>
</div>

- 网络层是个大 Boss， 负责给数据链路层这个`小秘书`下达任务，让小秘把 5 份文件给 B 公司，小秘呢，就找送快递`物理层`去做这个事。

- 但物理层是个傻子，他只知道拿起文件就飞奔到 B 公司，中间丢没丢东西也不清楚，所以数据链路层这个小秘书必须心里有底，一共送了 5 个文件，并且写到了快递外层。B 公司小秘在拿到傻子送到的文件时，就要看看到底有没有文件丢了，如果丢了就要让傻子回去重新拿丢掉的文件。

- 从这个故事中，我们可以总结下数据链路层主要功能：

### 数据链路层的主要功能

#### 封装成帧

数据链路层并不是无脑转发 boss 的信息，她要把文件编号封装一下。封装的网络数据包，在链路层就叫`数据帧`。

<div class="img-layout">
  <img src="../illustrations/bas_know_of_com_met/frame_of_DLL.png"/>
</div>

#### 透明传输

透明传输是指不管 boss 下达的任何信息，比如文件里有裁掉这个秘书的信息，秘书都要原原本本的传输。帧的数据部分可能有`跟帧首部完全一样`的字符，这时候就要采取一定的措施，让接受方不要被被误导，能让接收方知道哪些是帧的首部哪些是帧的数据。这个问题有点类似 js 的转义字符的问题，比如字符串`<div>`到底是指 div 标签呢，还是 div 字符串呢？

#### 差错控制

差错控制是在文件送到 B 公司小秘书手里的时候，快递包上写着 5 个文件，秘书一看只有 3 个文件，就会让傻子重新发送有没有送到的文件。差错控制的方法有`CRC循环冗余码`（这个就不细讲了，作者自己也不甚了解，只知道链路层的帧，会有一个 FCS 位留给这个码，用来判断一个帧是否出错）

#### 差错纠正

差错纠正是链路层知道 1，2，3，4，5 个文件，丢失的两个文件到底是哪两个，并且能通过重新发送没有的文件来纠正。

还有一些是故事里没有提到的数据链路层的功能，比如：

#### 流量控制

比如说发`送方发送速度特别快，接收方接收速度特别慢`，会造成传输出错。

这里需要注意的是，传输层`TCP`也有`流量控制`功能，区别在于`TCP`是`端到端`的流量控制，链路层是`点到点`（比如一个路由器到下一个路由器）

流量控制的方法有`滑动窗口协议`，以及`选择重传协议`，这两个留在讲 TCP 的时候讲。接下来讲一下以太网，以太网是目前最常见的局域网技术。对于我们理解局域网比较有帮助。

## 以太网和无线网

以太网是一种`局域网`技术，其规定了`访问控制方法`、`传输控制协议`、`网络拓扑结构`、`传输速率`等，完成数据链路层和物理层的一些内容，它采用一种称作`CSMA/CD`的媒体接入方法（后面会介绍），另外的一些局域网技术，比如`无线局域网`等。

### 以太网的帧格式

<div class="img-layout">
  <img src="../illustrations/bas_know_of_com_met/frame_format_for_ethernet.png"/>
</div>

- 其中`目的地址`和`源地址`指的是`MAC地址`，即设备的物理地址。MAC 地址用于标示网卡，每个网卡都具有唯一的 MAC 地址。
- 当在同一个局域网中，主机 A 需要给主机 B 发送消息时，主机 A 将`以太网帧`发出，此时局域网中所有主机均可收到这个桢，主机中的网卡接收到以太网桢后，会将目的 MAC 地址和自己的 MAC 地址进行比较，`如果不相同就会丢弃，如果相同则会接收`，此时则Ｂ主机就收到了Ａ的消息。
- 其最后面是 CRC 循环冗余码，用于`差错控制`，即检验`帧的正确性`。
- 在以太网协议中，目的地址分为三种`单播地址`、`广播地址`、`多播地址`，其中单播地址如上面Ａ给Ｂ主机发送，其接收者为一个，并且其目的地址的最高字节的低位为`0`

### 以太网的特点

- 无连接。发送方和接收方不建立连接。
- 不可靠。接收方不向发送方进行确认，差错帧直接丢弃。

### 以太网的拓扑结构

跟以太网相关的拓扑结构有`星型`和`总线型`。

星型拓扑如下：

<div class="img-layout">
  <img src="../illustrations/bas_know_of_com_met/star_topo.png"/>
</div>

总线型拓扑如下：

<div class="img-layout">
  <img src="../illustrations/bas_know_of_com_met/bus_topo.png"/>
</div>

互联网初期，以太网的`总线型拓扑`比较普遍。随着总线型以太网上的站点数目增多，`可靠性也会随之下降`，而随着大规模集成电路以及专门芯片的发展，使得`星型以太网变得便宜又可靠`。

需要注意的是，以太网虽然物理上是`星型拓扑`，但逻辑上是`总线型`。

### 网卡

计算机传出的数据，经过网卡，就会变成`以太网的帧`，还会完成一些`链路管理`（CDMA/CD 的实现），以及`编码和译码`。

### 无线局域网

无线局域网`WLAN`是利用`无线电波`、`激光`和`红外线`等无线通信技术来构建的局域网。

无线局域网我们只介绍一下典型的网络结构。

<div class="img-layout">
  <img src="../illustrations/bas_know_of_com_met/WLAN.png"/>
</div>

- 上图的`AP`就是`通信基站`，如果基站覆盖的移动设备可以直接通过基站来通信
- 如果是不同基站的移动设备，不仅仅要通过自己的基站传输数据，还需要`基站和基站之间传输数据`，来达到两个在不同基站覆盖范围内的无线设备通信。

### CSMA/CD 协议

因为这个协议是`以太网所使用`的，所以我们只需要记住一些特点就行了。

- 每一个站在发送数据之前以及发送数据时都要检测一下总线上是否有其他计算机在发送数据。
- 是`总线型`，`半双工网络`（半双工是指允许数据在两个方向上传输，但是在某一时刻，只允许数据在一个方向上传输）

### 链路层的设备

#### 网桥

网桥根据`MAC帧`的目的地址进行转发和过滤。当网桥收到一个帧时，并不会向所有接口转发此帧，而是先检查此帧的目的`MAC地址`，然后再确定将该帧转发到哪一个口，或者是把它丢弃。

<div class="img-layout">
  <img src="../illustrations/bas_know_of_com_met/net_bridge.png"/>
</div>

这里需要注意的是，网桥连接的是不同的网段，网段是什么呢，具体讲`IP地址`的时候细说，同一网段指的是`IP地址`和`子网掩码`相与得到相同的网络地址。

#### 以太网交换机

谈到交换机，就不得不提两个概念，`冲突域`和`广播域`

- 冲突域：是指同一时间`只能由一台设备`发送信息的范围。
- 广播域：如果站点发出一个广播信号，`所有能接收到这个信号`的设备范围称为广播域。
- 也就是说，广播域可以`跨网段`，而冲突域是`同一个网段`。

举个例子，公司里大家的电脑一般都是连接到`交换机`上，因为交换机可以`隔离冲突域`，`冲突域`的最大问题在于，同一时间只能有一台机器传输数据，公司那么多人，如果这样的话，传输数据速度太慢了。然后交换机再连接到`路由器`上，首先`路由器`能隔离广播域，其次`不经过路由器，你的数据链路层上的包`没办法进入到互联网里面去，路由器是网络层的设备。

## 网络层

### 网络层的概念

网络层主要任务是将`分组`（分组的概念是，大多数计算机网络都不能连续地传送任意长的数据，所以实际上网络系统把数据分割成小块，然后逐块地发送，这种小块就称作分组）从一台主机移动到另一台主机，从而提供了主机到主机的通信服务和各种形式的`进程到进程的通信`。

### 学习网络层需要了解的概念

#### 分组交换

当`主机H1`要向另一`主机H2`发送数据（报文）时，首先将数据划分成若干个`等长的分组`，然后将这些分组一个接一个地发往与`H1`相联的`路由A`，当`A`接到分组后，先放入缓冲区，再按一定的路由算法确定该分组下一步将发往哪个节点，如此一个节点一个节点传递，直到`最终目的H2`。

简单来说，分组就是`分数据块`，同时还具有`无需建立连接`，`存储转发`（存储转发是指以太网交换机的控制器先将输入端口接收的数据包缓存起来，先检查数据包是否正确，并过滤掉冲突包错误），`动态分配路线`（交换设备会根据网络状况选择不同的路线，比如路由器）的优点。

#### 数据报

数据报是通过网络传输的`数据的基本单元`，包含一个`报头（header）`和`数据`本身。说白了，就是带地址的数据，比如你写了一句微信“你好”，这串文本加上源地址，目的地址，就是数据报。

#### 数据报格式

<div class="img-layout">
  <img src="../illustrations/bas_know_of_com_met/datagram_format.png"/>
</div>

- 首部的固定部分是`20字节`，共 20 \* 8 = 160 比特 （1 字节 = 8 比特）
- `0 - 4`比特是`版本号`，版本有`ipv4`/`ipv6`
- 首部长度，`单位是4B`，最小为 5，为什么是 5？因为首部至少 20 字节，所以 4 \* 5 就是 20 字节
- 区分服务不用看
- 总长度是`首部 + 数据`
- 生存时间是`TTL`，它告诉网络，数据包在网络中的时间是否太长而因被丢弃。每经过一个路由器减一，变成 0 就丢弃
- 协议是指数据部分用的什么协议，我们只需要知道`TCP`协议用`6`表示，`UDP`协议用`17`表示即可。
- `首部校验和`占 16 位。这个字段只检验数据报的首部，但不包括数据部分。
- 目的地址和源地址都是`IP地址`，目的地址是通过`DNS`查询得来的。

#### IP 分片

> 为什么要分片呢？

链路层数据帧封装的`数据大小是有限制`的，以太网的`MTU`（MTU 是指一种通信协议的某一层上面所能通过的最大数据包大小）是`1500字节`。

接下来我们就看看在 ip 数据包上，哪些字段标识了分片的数据呢？

<div class="img-layout">
  <img src="../illustrations/bas_know_of_com_met/datagram_fragmention.png"/>
</div>

- 标识实在`同一数据的分片`时相同
- 标志占 3 位，但只有两位有意义，第一个位叫`MF`，`MF = 1`即表示后面“还有分片”的数据报。`MF = 0`表示这已是若干数据报片中的最后一个。
- 标志字段中间的一位记为`DF`（Don't Fragment），意思是“不能分片”。只有当`DF = 0`时才允许分片。
- 片偏移，较长的分组在分片后，某片在原分组中的相对位置。

#### ip 地址分类

<div class="img-layout">
  <img src="../illustrations/bas_know_of_com_met/ip_addr_classify.png"/>
</div>

ip 地址有 5 种

- A 类：`1.0.0.0~126.255.255.255`
- B 类：`128.0.0.0~191.255.255.255`
- C 类：`192.0.0.0~223.255.255.255`
- D 类：`224.0.0.0~239.255.255.255`
- E 类：`240.0.0.0~254.255.255.255`
- 其中`127.0.0.0~127.255.255.255`用于环回测试，D 类地址用于组播，E 类地址用于科研

这里需要注意的是，你发现没，为什么我们前端启动 webpack 测试环境的时候，一般地址都是 192.168.\*.\*（\*是指 0-255 的数字）；在公司和家里都是这个网段，不是很奇怪吗，你家里的网段怎么和公司一样呢？

其实是因为有一部分叫`私有IP地址`，是不能拿到网络上跟别的计算机通信的。`只能是局域网`自己内部用。比如说有：

| 地址类别 | 地址范围                    | 网段个数 |
| -------- | --------------------------- | -------- |
| A 类     | 10.0.0.0~10.255.255.255     | 1        |
| B 类     | 172.16.0.0~172.31.255.255   | 16       |
| C 类     | 192.168.0.0~192.168.255.255 | 256      |

可以看到，C 类私有地址就是 192.168 网段，每个局域网都可以有这些私有 IP。

还有一些`特殊地址`，需要了解：

| NetID 网络号 | HostID 主机号      | 用途                                         |
| ------------ | ------------------ | -------------------------------------------- |
| 全 1         | 全 1               | 本网广播地址（路由器不转发）                 |
| 特定值       | 全 0               | 网络地址，表示一个网络                       |
| 特定值       | 全 1               | 直接广播地址，对特定网络上的所有主机进行广播 |
| 127          | 任何数（非全 0/1） | 用于本地软件唤回测试，称为环回地址           |

注意，这里的全 1 是指，`ipv4地址由4个字节组成`，每个字节是 8 位，8 位全 1 就是`十进制的255`，即`255.255.255.255`。

- 第一行，全 1，代表是`255.255.255.255`，在本网络的目的地址写这个的话，就会`内网广播`
- 第二行，网络号特定值，主机号是全 0，比如，`192.169.10.1`，这是 C 类网络，所以网络号是`192.169.10`，主机号是`1`，当主机号全 0 时，就是 0，表示`192.169.10.0`这个网段
- 第三行，还是`192.169.10.1`这个 C 类地址，主机号都是 1，也就是 8 个 1，代表 255，所以`192.169.10.255`表示本网段的广播地址
- 第四行，大家最熟悉不过了，`127`作为网络号，主机号非全 0 或 1，比如说`127.0.0.1`代表本机，称位`环回地址`

#### 网络地址转换（NAT）

在 ip 地址分类里面，我们知道`私有ip地址`是不能跟外网交互的，在小公司大多数计算机的地址都是`192.168`网段，都是私有 ip 地址，它是怎么跟外网交互数据的呢，这里就引出来一个知识点叫`网络地址转换NAT`。

<div class="img-layout">
  <img src="../illustrations/bas_know_of_com_met/nat_address_switch.png"/>
</div>

如上图所示，`192.168.0.3`，`192.168.0.4`都是私有网段上的，他们无法跟外网通信，这个时候由于路由器安装了 NAT 软件，就可以将自己的 ip 地址，即路由器的 ip 地址`172.38.1.5`作为内网的代理，去访问外网，外网返回来的数据，经过路由变换，转换成内网的`192.168`网段的私有地址。

#### 子网划分和子网掩码

首先要明白，为什么要划分子网？

> 首先大家要知道：总体来说，划分子网不但没有增加可用 IP 地址，而且减少了可用 IP 地址，因为每个子网中的全 0 网络地址和全 1 广播地址均不能作为主机 ip 来使用。

为什么划分子网：

- 例如，一个 A 类网络可以容纳 16777214 台主机
- 但是在实际运用中，不可能把一个 A 类网络只用于一个子网，因为那样管理起来很不方便，也会出现广播风暴等种种问题，所以需要根据实际需求把它划分为若干个较小的子网。一个 B 类网络可以容纳 65534 台主机，往往也是需要划分子网的
- 即便一个小型企业内部，为了部门之间的职能需要，配置哪些电脑可以互相访问，哪些不能互相访问，就需要通过划分子网的方法来实现

接下来，我们看看子网划分：

<div class="img-layout">
  <img src="../illustrations/bas_know_of_com_met/subnetting.png"/>
</div>

如上图右侧，我们将`145.13.0.0`这个网段划分成了三个子网，其中一个是`145.13.3.0`，一个是`145.13.21.0`，问题来了，如果一个网络包来了，网络包要交给的 ip 地址是`145.13.3.10`，我们怎么知道给哪个子网呢？

方法是将目的包的 ip 地址，跟子网的`子网掩码`相与预算（二进制与预算规则是，1 跟 1 得 1，其它为 0），也就是目的地址`145.13.3.10`跟子网`145.13.3.0`的子网掩码`255.255.255.0`的与预算，得到的结果是`145.13.3.0`，所以发送到的子网就是`145.13.3.0`。

> 这里有人会问什么是子网掩码，子网掩码的格式跟 IP 一样的，`0.0.0.0`到`255.255.255.255`，主要是帮助我们划分子网的

### ARP 协议

> 为什么需要 ARP 协议呢

我们简单回顾一下以太网的帧格式：

<div class="img-layout">
  <img src="../illustrations/bas_know_of_com_met/frame_format_for_ethernet.png"/>
</div>

上图有一个`源地址`和`目的地址`，这两个地址都是指的`MAC地址`，`MAC地址`是什么呢？简单说来就是两台相邻的路由器 A 和 B，A 怎么把数据传给 B 呢，它总要知道 B 的物理地址吧，物理地址就像`门牌号`一样，我要知道你住在哪儿，才能把数据发过去。

首先你肯定知道自己的 MAC 地址是多少，因为网卡上有，问题在于，别人的`MAC地址`是多少？`ARP协议`就是来帮你找`MAC地址`的。

> 接着我们说一下`ARP协议`的过程

<div class="img-layout">
  <img src="../illustrations/bas_know_of_com_met/ARP_protocol.png"/>
</div>

- 每台主机都会在自己的 ARP 缓冲区中建立一个`ARP列表`，以表示`IP地址`和`MAC地址`的映射关系
- 当源主机需要将一个数据包发送到目的主机时，会首先检查自己`ARP列表`中是否存在该`IP地址`对应的`MAC地址`
- 如果有，就直接将数据包发送到这个`MAC地址`；如果没有，就向本地网段发起一个`ARP请求`的广播包，查询此目的主机对应的`MAC地址`
- 此`ARP请求`数据包里包括`源主机的IP地址`、`硬件地址`、以及`目的主机的IP地址`。网络中所有的主机收到这个`ARP请求`后，会检查数据包中的目的 IP 是否和自己的 IP 地址一致
- 如果不相同就忽略此数据包；如果相同，该主机首先将发送端的`MAC地址`和`IP地址`添加到自己的`ARP列表`中
- 如果`ARP表`中已经存在该 IP 的信息，则将其覆盖，然后给源主机发送一个`ARP响应`数据包，

(_未完待续_)
